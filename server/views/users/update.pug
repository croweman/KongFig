doctype html
html(lang='en')

  include ../includes/head.pug

  body

    include ../mixins/user-permissions-selection.pug
    include ../includes/nav-bar.pug

    #top.jumbotron
      .container
        h2.display-6 User Update

    .container

      form

        input#userid.input(style='display:none', value=userId)

        #username-form-group.form-group
          label.form-control-label User name
          label
          input.form-control(type='text', readonly='' placeholder=selectedUser.userName)

        #roles-form-group.form-group
          label.form-control-label(for='roles') Roles (multiple)
          - administratorSelected = (selectedUser.roles.indexOf('administrator') !== -1)
          - teamCreatorSelected = (selectedUser.roles.indexOf('team-writer') !== -1)
          - keyCreatorSelected = (selectedUser.roles.indexOf('key-writer') !== -1)
          select#roles.form-control(multiple='')
            if administratorSelected === true
              option(selected=administratorSelected) administrator
            else
              option administrator
            if teamCreatorSelected === true
              option(selected=teamCreatorSelected) team-writer
            else
              option team-writer
            if keyCreatorSelected === true
              option(selected=keyCreatorSelected) key-writer
            else
              option key-writer

        .form-group
          .form-check
            label.form-check-label
              span= userEnabled
              if selectedUser.enabled === true
                input#enabled.form-check-input(type='checkbox', checked='checked')
              else
                input#enabled.form-check-input(type='checkbox')
              |  Enabled

        .form-group
          label
            h4 Team Permissions

            +userPermissionSelection('select_teams', 'label_teams', 'select-all-teams', 'team-permissions', 'team-write', teams.length > 0, 'Select all', 'Deselect all')

            ul#team-permissions
              each team in teams
                li= team.teamId + ' (' + team.teamName + ')'
                  .form-check.form-check-inline
                    label.form-check-label
                      if team.write === true
                        input.form-check-input.team-write(type='checkbox', data-id=team.teamId, checked='checked')
                      else
                        input.form-check-input.team-write(type='checkbox', data-id=team.teamId)
                      |  Write

        .form-group
          label
            h4 App Configuration Permissions

            ul
              each team in teams
                li= team.teamId + ' (' + team.teamName + ')'
                  - ulId = 'team-' + team.teamId
                  +userPermissionSelection('select_team_' + team.teamId + '_apps', 'label_team_' + team.teamId + '_apps', 'select-all-permissions', ulId, 'app-env', team.apps.length > 0, 'Select all', 'Deselect all')

                  ul(id=ulId)
                    each app in team.apps
                      - ulId = 'container_' + app.appId
                      li= app.appId + ' (' + app.appName + ')'
                        +userPermissionSelection('select_all_' + app.appId, 'label_all_' + app.appId, 'select-all-permissions', 'container_' + app.appId, 'app-env', true, 'Select all', 'Deselect all')
                        +userPermissionSelection('select_all_read' + app.appId, 'label_all_read' + app.appId, 'select-all-permissions', 'container_' + app.appId, 'app-read', true, 'Read', 'Read')
                        +userPermissionSelection('select_all_write' + app.appId, 'label_all_write' + app.appId, 'select-all-permissions', 'container_' + app.appId, 'app-write', true, 'Write', 'Write')
                        +userPermissionSelection('select_all_publish' + app.appId, 'label_all_publish' + app.appId, 'select-all-permissions', 'container_' + app.appId, 'app-publish', true, 'Publish', 'Publish')
                        +userPermissionSelection('select_all_delete' + app.appId, 'label_all_delete' + app.appId, 'select-all-permissions', 'container_' + app.appId, 'app-delete', true, 'Delete', 'Delete')

                      ul(id=ulId)
                        each environment in app.environments
                          li
                            label
                              strong= environment.name + ':  '
                              .form-check.form-check-inline
                                label.form-check-label
                                  if environment.read === true
                                    input.form-check-input.app-env.app-read(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='read', checked='checked')
                                  else
                                    input.form-check-input.app-env.app-read(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='read')
                                  |  Read
                              .form-check.form-check-inline
                                label.form-check-label
                                  if environment.write === true
                                    input.form-check-input.app-env.app-write(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='write', checked='checked')
                                  else
                                    input.form-check-input.app-env.app-write(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='write')
                                  |  Write
                              .form-check.form-check-inline
                                label.form-check-label
                                  if environment.publish === true
                                    input.form-check-input.app-env.app-publish(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='publish', checked='checked')
                                  else
                                    input.form-check-input.app-env.app-publish(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='publish')
                                  |  Publish
                              .form-check.form-check-inline
                                label.form-check-label
                                  if environment.delete === true
                                    input.form-check-input.app-env.app-delete(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='delete', checked='checked')
                                  else
                                    input.form-check-input.app-env.app-delete(type='checkbox', data-id=app.appId, data-environment=environment.name, data-type='delete')
                                  |  Delete

        div.text-right
          button#updateUser.btn.btn-primary(type="button", data-loading-text="<i class='icon-spinner icon-spin'></i> Updating user") Update User

        include ../includes/error-box.pug

      include ../includes/footer.pug

    include ../includes/scripts.pug

    script(type='text/javascript').
      $(function() {
          elencyConfig.updateUser();
      });